/** 
 * @file    model_mlp_f32_2_15_5_1.c
 * @brief
 *
 * @author  guo yao
 * @date    2025/11/10
 * @history
 * |    Date    |  Version  |   Author    |    Description   |
 * |------------| --------  |-------------|------------------|
 *
**/

#include "power_ai/ann/fcnn_eval.h"
#include "power_ai/common/typedef.h"

#define N_FEATURES (2)
#define N_OUT (1)

fcnn_eval *nn;

float32 weight0[15 * N_FEATURES] = {
    -1.1116789f, -1.7535834f, 0.4213934f, -1.1681386f, -0.0047732f, -1.5396132f, 0.1363550f, -0.0979245f, 1.4788944f,
    0.6789647f, 1.0974622f, 1.4501241f, -1.7490090f, -1.1687436f, 0.4194092f, -0.3671121f, -0.5137733f, 0.7112186f,
    0.2058037f, 1.3599889f, 0.1337793f, -0.6429195f, -1.4873053f, -0.7953155f, -2.6707919f, -0.4274723f, -0.7845227f,
    -0.2315241f, 1.6277243f, -1.9910604f
};
float32 bias0[15] = {
    2.6723980f, -1.8752600f, 0.3469920f, 0.9668160f, 2.3396888f, 0.4139829f, 2.1234487f, 2.1105500f, 2.4278626f,
    0.5816234f, -0.7535515f, -1.4276889f, -1.1775594f, 0.0316752f, 0.9173547f
};

float32 weight1[5 * 15] = {
    0.3871998f, -0.8434016f, -0.8937252f, 0.3994360f, 0.5318564f, -0.3004588f, -1.4109221f, -1.3472771f, 0.0321627f,
    1.2798208f, -0.0918151f, 0.5195047f, -0.1562683f, 0.4981761f, -0.5984294f, -0.8805609f, 1.8726984f, -1.9564112f,
    -1.7336486f, -1.5243391f, 0.6577707f, 0.1663898f, 0.7969174f, -0.7527037f, 0.0133538f, 0.3540222f, -0.9671580f,
    -0.6694280f, -1.7694056f, -0.5095655f, 0.7201483f, 0.2347147f, -0.0873189f, -1.1897190f, -0.2161082f, 0.4398028f,
    1.8966759f, 1.0707215f, -2.3010609f, 0.4500150f, 1.1187003f, -1.0430697f, -0.5672877f, 0.2342453f, 1.1213845f,
    0.2706332f, -0.8239632f, 0.7549277f, -0.3792323f, 1.0612301f, -0.2082441f, 1.1355169f, 0.9648599f, -0.3361594f,
    1.1322123f, 1.2124775f, 1.9256562f, -0.4460245f, 0.4351632f, -0.3077328f, 1.2859024f, -1.4634334f, -0.2511405f,
    1.2853766f, -0.7234953f, -1.3986311f, -0.8980675f, 0.5917584f, -2.3622754f, 0.8178694f, 1.3709494f, -0.1427448f,
    0.7435177f, 1.2173120f, -0.9112802f
};
float32 bias1[5] = {0.8582829f, 0.3522599f, -0.5724401f, 1.4162922f, 0.3464992f};

float32 weight2[N_OUT * 5] = {0.2294957f, -1.0999600f, 0.9962136f, -1.9974459f, -0.6410667f};
float32 bias2[N_OUT] = {-1.7238570f};

float32 xMean[N_FEATURES] = {-0.9216532f, -0.2435501f};
float32 xStd[N_FEATURES] = {0.5050835f, -0.6511153f};

void MODEL_Init()
{
    DenseDefF32 layers[] = {
        {15, N_FEATURES, ACT_FN_RELU, weight0, bias0},
        {5, 15, ACT_FN_RELU, weight1, bias1},
        {N_OUT, 5, ACT_FN_STRAIGHT, weight2, bias2}
    };
    nn = fcnn_eval_create_f32(layers, 3);
}

extern void TESTSTART_Task1(void);
extern void TESTEND_Task1(void);

void MODEL_Run()
{
    TESTSTART_Task1();
    float32 xRaw[N_FEATURES] = {1, 2};
    float32 xTf[N_FEATURES] = {0};
    for (uint8 i = 0; i < N_FEATURES; i++) {
        xTf[i] = (xRaw[i] - xMean[i]) / xStd[i];
    }
    fcnn_eval_forward_f32(nn, xTf);
    TESTEND_Task1();
}
