/** 
 * @file    model_mlp_f32_2_15_5_1.c
 * @brief
 *
 * @author  guo yao
 * @date    2025/11/10
 * @history
 * |    Date    |  Version  |   Author    |    Description   |
 * |------------| --------  |-------------|------------------|
 *
**/

#include "power_ai/ann/fcnn_eval.h"
#include "power_ai/common/typedef.h"

#define N_FEATURES (16)
#define N_OUT (1)

fcnn_eval *nn;

int16 weight0[32 * N_FEATURES] = {
    -336, -930, 946, 38, 476, 229, -367, 373, -718, -654, 126, -260, 989, 310, -691, 961, 324, 1019, -290, -264, 638,
    523, -752, -389, -242, -23, -7, -310, -217, -957, -767, -858, 863, 294, -181, -895, -68, -313, -759, -953, -111,
    -349, 553, -110, 328, 991, -287, -485, 448, -832, 202, 103, -301, 491, 740, -164, 97, -203, -286, -938, 939, 130,
    191, 28, 34, 608, -771, 348, 41, 149, 511, 949, -458, 240, -673, 78, 135, 793, -649, -617, -411, -629, 436, 857,
    -670, 893, -545, 996, -538, -694, 571, -214, -1020, -95, 738, 517, -201, 214, -604, -332, 954, -752, 108, -1018,
    -932, 477, -420, 712, -609, -794, -731, -369, -782, 607, 952, 891, 211, 320, -217, 819, 622, -205, 295, -47,
    -916, -958, -153, 965, -788, -867, -198, 905, 857, 170, 612, 651, -23, -156, -342, -140, -777, 469, 204, -419, 4,
    715, 519, -901, 932, 474, 931, 687, -460, -300, -811, -498, -192, -488, -955, -794, 901, 684, -733, 463, -187, 290,
    -218, 39, 681, -659, 413, 111, -475, 469, 400, 778, -231,
    -1020, 769, 21, 60, 561, -660, -229, 854, -817, -852, 209, -515, -609, -461, 553, -459, 976, -6, 212, -395, -339,
    475, -131, 578, 253, -33, -742, -786, -103, 466,
    128, -228, 276, -907, 262, 882, 990, 450, 716, -1002, 131, 1017, -998, -791, 526, -131, 621, 47, 934, -558, 287,
    -795, 540, -932, -224, -725, 946, 386, 270, -906, -985, 764, -802, -114, -1016, -624, -986, 624, -957, 686, 345,
    -520, 632, -196, -976, -419, -152, 512, 967, 681, 469,
    395, -318, 907, -949, -409, -765, -1003, 617, -606, -500, -35, 872, 945, 327, -591, 872, -132, -395, -305, 619, 446,
    279, -917, 357, -787, 331, -894, 208, 864, -913, -668, -672, 532, -192, -566, 666, 628, -495, 92, -904, 702, -905,
    -384, -176, 428, -554, 226, -900, 420, 78, -596,
    -934, -952, -839, 974, 140, -888, -791, 438, 781, -31, -546, -616, 183, 66, 6, 216, 919, 663, -155, 354, 611, 565,
    902, 373, -603, 547, -974, -139, 294, -272, 652, -522, 1004, -727, 172, -432, 265, 494, 613, -605, 46, 127, 521,
    -536, 334, 484, -916, 856, -462, 441, -652, -913, 412,
    -577, 682, 179, 101, 770, -692, 380, -51, -872, 3, -146, -519, -271, 321, -861, 27, 477, 829, 586, -78, -255, -625,
    504, -494, -879, 174, -551, -817, 880, -964, -504, -353, -638, 496, 993, -615, 904, -886, -91, -278, 427, 252, 670,
    -46, 399, -554, -18, -659, -322, 864, 631, -176, -
    842,
    221, 629, -265, 692, 205, 190, -377, 686, -80, -370, 675, 679, -506, -309, -333, -308, -995, -508, -476, -940, 55,
    -663, 802, -792, -736, 357, -331, -633, 821, -390, -890, -279, -529, -856, -852, 876, -495, 794, 701, -185, -756,
    124, -909, 244, 694, -273, 816, 276, -901, -78, 916, -91, -878, 217, -103, 91, 766, -677, 459, 445, 670, -881, 70,
    973, 80, -368, -859, -91, 179, -382, 109, 12, 449, 187, -954, -555, -26, -637, 380, 596, 580, -674, 751, 279, -105,
    -647, -729, 445, 759, 170, -384, -504, -275, -117, 33, -816, -995
};
int16 bias0[32] = {
    -300, -352, 778, 87, 64, 787, 6, 404, -668, 787, -936, 681, 114, -471, -55, 166, -867, -40, 661, 4, -799, -390,
    -605, -660, 275, 376, 802, -804, 424, 342, 48, -982
};

int16 weight1[N_OUT * 32] = {
    599, -360, -1022, -865, 943, -974, 113, -981, -274, 563, -909, 431, -307, 860, -377, 963, 257, 282, 917, 322, -587,
    -230, 207, -643, -922, 470, 382, 959, -347, -275, -48, 856
};
int16 bias1[N_OUT] = {539};

int16 xMean[N_FEATURES] = {
    866, -638, 584, -938, -828, 786, 920, -361, 465, -45, -986, -879, 507, -960, 947, 650
};
int16 xStd[N_FEATURES] = {
    866, -638, 584, -938, -828, 786, 920, -361, 465, -45, -986, -879, 507, -960, 947, 650
};

void MODEL_Init()
{
    DenseDefF32 layers[] = {
        {32, N_FEATURES, ACT_FN_RELU, weight0, bias0},
        {N_OUT, 32, ACT_FN_STRAIGHT, weight1, bias1},
    };
    nn = fcnn_eval_create_f32(layers, 2);
}

extern void TESTSTART_Task1(void);

extern void TESTEND_Task1(void);

void MODEL_Run()
{
    TESTSTART_Task1();
    int16 xRaw[N_FEATURES] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16};
    int16 xTf[N_FEATURES] = {0};
    for (uint8 i = 0; i < N_FEATURES; i++) {
        xTf[i] = (int16) ((xRaw[i] - xMean[i]) / xStd[i]);
    }
    fcnn_eval_forward_f32(nn, xTf);
    TESTEND_Task1();
}
