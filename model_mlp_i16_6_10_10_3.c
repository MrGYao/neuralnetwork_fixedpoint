/** 
 * @file    model_mlp_f32_2_15_5_1.c
 * @brief
 *
 * @author  guo yao
 * @date    2025/11/10
 * @history
 * |    Date    |  Version  |   Author    |    Description   |
 * |------------| --------  |-------------|------------------|
 *
**/

#include "power_ai/ann/fcnn_eval.h"
#include "power_ai/common/typedef.h"

#define N_FEATURES (6)
#define N_OUT (3)

fcnn_eval *nn;

int16 weight0[10 * N_FEATURES] = {
    -473, -435, -820, 53, 509, 496, 463, 829, 96, 31, 609, -523, -807, -445, -27, 140, -31, 560, 902, 1019, -1012, 962,
    343, -429, -124, -988, -554, -509, -3, -250, -417, 934, -189, 201, 458, 684, 946, -1003, -130, 653, 161, -323, -416,
    -748, 281, 255, 999, -590, -204, 250, -145, 57, -542, 508, 123, 666, 901, 21, 14, 419
};
int16 bias0[10] = {
    -279, -312, -195, -106, -153, 1018, -267, 847, 950, 105
};

int16 weight1[10 * 10] = {
    -584, -879, 725, 122, -491, 350, -651, -994, 243, 382, -238, -223, 525, -431, 274, 832, 812, 340, 530, 351, 266,
    580, 850, 725, 517, -946, -55, 1019, -204, -974, 25, 98, -50, -461, 397, 958, 575, -855, 104, 25, 421, 552, 560,
    -982, 827, 480, -879, -576, -66, 813, -816, -535, 545, -883, 370, -703, -832, -675, -545, 843, -403, -405, 719,
    -604, 705, 466, 903, -368, -148, -429, -1016, 429, -886, 175, 835, 255, 853, 409, 140, 626, -367, -35, -1020, -822,
    458, -821, 187, 858, 42, -898, 456, -874, -726, 480, 442, -907, 215, 782, -205, -574
};
int16 bias1[10] = {
    -534, -246, 123, -221, -198, 196, 565, -744, -697, 469
};

int16 weight2[N_OUT * 10] = {
    750, -534, 924, 770, -102, 407, -567, 17, 850, -455, -834, -997, -801, -143, -930, 362, 476, -278, -172, -843, 776,
    598, 1002, 459, 526, 137, 314, 407, -787, -647
};
int16 bias2[N_OUT] = {836, -633, -699};

int16 xMean[N_FEATURES] = {750, -534, 924, 770, -102, 407};
int16 xStd[N_FEATURES] = {526, 137, 314, 407, -787, -647};

void MODEL_Init()
{
    DenseDefI16 layers[] = {
        {15, N_FEATURES, ACT_FN_RELU, weight0, bias0},
        {5, 15, ACT_FN_RELU, weight1, bias1},
        {N_OUT, 5, ACT_FN_STRAIGHT, weight2, bias2}
    };
    nn = fcnn_eval_create_i16(layers, 3);
}

extern void TESTSTART_Task1(void);

extern void TESTEND_Task1(void);

void MODEL_Run()
{
    TESTSTART_Task1();
    int16 xRaw[N_FEATURES] = {1, 2, 3, 4, 5, 6};
    int16 xTf[N_FEATURES] = {0};
    for (uint8 i = 0; i < N_FEATURES; i++) {
        xTf[i] = (int16) ((xRaw[i] - xMean[i]) / xStd[i]);
    }
    fcnn_eval_forward_i16(nn, xTf);
    TESTEND_Task1();
}
